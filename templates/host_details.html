<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Host Details - Zabbix Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
<script src="{{ url_for('static', filename='js/bootstrap.bundle.js') }}"></script>
<script src="{{ url_for('static', filename='js/chart.umd.min.js') }}"></script>
    <style>
       * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --bg-primary: #0a0e27;
    --bg-secondary: #1a1f3a;
    --bg-card: #1e2541;
    --text-primary: #ffffff;
    --text-secondary: #a0aec0;
    --accent: #6366f1;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --sidebar-width: 260px;
    --sidebar-collapsed: 70px;
}

/* Base */

body {
    background: var(--bg-primary);
    font-family: 'Inter', sans-serif;
    color: var(--text-primary);
    display: flex;
    min-height: 100vh;
}

/* Icons */

.icon {
    width: 1.2rem;
    height: 1.2rem;
    display: inline-block;
    vertical-align: middle;
}

.icon-lg {
    width: 1.75rem;
    height: 1.75rem;
}

.icon-xl {
    width: 2rem;
    height: 2rem;
}

.icon-white {
    filter: brightness(0) invert(1);
}

.icon-accent {
    filter: brightness(0) saturate(100%) invert(45%) sepia(89%) saturate(2234%)
        hue-rotate(226deg) brightness(98%) contrast(93%);
}

.icon-warning {
    filter: brightness(0) saturate(100%) invert(67%) sepia(76%) saturate(470%)
        hue-rotate(357deg) brightness(101%) contrast(97%);
}

.icon-danger {
    filter: brightness(0) saturate(100%) invert(32%) sepia(97%) saturate(2580%)
        hue-rotate(345deg) brightness(99%) contrast(92%);
}

.icon-success {
    filter: brightness(0) saturate(100%) invert(61%) sepia(48%) saturate(752%)
        hue-rotate(105deg) brightness(94%) contrast(87%);
}

/* Sidebar */

.sidebar {
    position: fixed;
    left: 0;
    top: 0;
    height: 100vh;
    width: var(--sidebar-width);
    background: var(--bg-secondary);
    border-right: 1px solid rgba(255,255,255,0.05);
    overflow-y: auto;
    overflow-x: hidden;
    z-index: 1000;
    transition: all 0.3s ease;
}

.sidebar.collapsed {
    width: var(--sidebar-collapsed);
    transform: translateX(0);
}

.sidebar-header {
    padding: 24px 20px;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.sidebar-logo {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 20px;
    font-weight: 700;
    color: var(--accent);
}

.sidebar-logo .logo-text {
    white-space: nowrap;
    transition: opacity 0.3s;
}

.sidebar.collapsed .logo-text {
    opacity: 0;
    display: none;
}

.sidebar-menu {
    padding: 20px 0;
}

.menu-item {
    display: flex;
    align-items: center;
    padding: 14px 20px;
    color: var(--text-secondary);
    text-decoration: none;
    transition: all 0.3s;
    cursor: pointer;
    border-left: 3px solid transparent;
    gap: 16px;
}

.menu-item:hover {
    background: rgba(255,255,255,0.05);
    color: var(--text-primary);
}

.menu-item.active {
    background: rgba(99,102,241,0.1);
    color: var(--accent);
    border-left-color: var(--accent);
}

.menu-item .menu-text {
    white-space: nowrap;
    transition: opacity 0.3s;
}

.sidebar.collapsed .menu-text {
    opacity: 0;
    display: none;
}

.sidebar.collapsed .menu-item {
    justify-content: center;
    padding: 14px 10px;
}

/* Sidebar toggles */

.sidebar-toggle {
    display: none;
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1001;
    background: var(--accent);
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 20px;
    align-items: center;
    justify-content: center;
}

.mobile-sidebar-toggle {
    display: none;
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1001;
    background: var(--accent);
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 20px;
    align-items: center;
    justify-content: center;
}

/* Main content */

.main-content {
    margin-left: var(--sidebar-width);
    min-height: 100vh;
    width: calc(100% - var(--sidebar-width));
    transition: all 0.3s ease;
}

.sidebar.collapsed + .main-content {
    margin-left: var(--sidebar-collapsed);
    width: calc(100% - var(--sidebar-collapsed));
}

/* Host header / generic header */

.header {
    background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--accent) 100%);
    padding: 32px;
    box-shadow: 0 4px 30px rgba(0,0,0,0.4);
}

.header-content,
.header-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
}

.header h1,
.header-text h1 {
    font-size: 32px;
    font-weight: 700;
    margin: 0 0 8px 0;
}

.header-text p {
    margin: 8px 0 0 0;
    opacity: 0.9;
}

.header-ip {
    font-size: 16px;
    color: rgba(255,255,255,0.8);
    font-weight: 500;
}

/* Header actions & buttons */

.header-actions {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
}

.back-btn {
    background: rgba(255,255,255,0.15);
    color: white;
    border: 1px solid rgba(255,255,255,0.2);
    padding: 10px 24px;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    display: inline-block;
    text-decoration: none;
    transition: all 0.3s;
}

.back-btn:hover {
    background: rgba(255,255,255,0.25);
    transform: translateX(-4px);
}

.action-btn {
    background: rgba(255,255,255,0.15);
    color: white;
    border: 1px solid rgba(255,255,255,0.2);
    padding: 10px 20px;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.action-btn:hover {
    background: rgba(255,255,255,0.25);
    transform: translateY(-2px);
}

.action-btn.primary {
    background: rgba(16,185,129,0.3);
    border-color: rgba(16,185,129,0.5);
}

.action-btn.primary:hover {
    background: rgba(16,185,129,0.4);
}

/* Shared button styles */

.btn {
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    border: none;
    font-size: 14px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-primary {
    background: var(--accent);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(99,102,241,0.4);
}

.btn-secondary {
    background: rgba(255,255,255,0.05);
    color: var(--text-primary);
}

.btn-secondary:hover {
    background: rgba(255,255,255,0.1);
}

.export-btn {
    background: linear-gradient(135deg, var(--success), #059669);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
    font-size: 14px;
}

.export-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(16,185,129,0.4);
}

.refresh-btn {
    background: rgba(99,102,241,0.9);
}

.refresh-btn:hover {
    box-shadow: 0 8px 20px rgba(99,102,241,0.4);
}

.add-location-btn {
    background: linear-gradient(135deg, var(--accent), #5558e3);
}

.add-location-btn:hover {
    box-shadow: 0 8px 20px rgba(99,102,241,0.4);
}

/* Time/status badges */

.status-badge {
    display: inline-block;
    padding: 8px 20px;
    border-radius: 24px;
    font-size: 13px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-excellent { background: rgba(16,185,129,0.2); color: #10b981; border: 1px solid rgba(16,185,129,0.3); }
.status-good      { background: rgba(132,204,22,0.2); color: #84cc16; border: 1px solid rgba(132,204,22,0.3); }
.status-fair      { background: rgba(245,158,11,0.2); color: #f59e0b; border: 1px solid rgba(245,158,11,0.3); }
.status-poor      { background: rgba(239,68,68,0.2); color: #ef4444; border: 1px solid rgba(239,68,68,0.3); }
.status-disabled  { background: rgba(107,114,128,0.2); color: #6b7280; border: 1px solid rgba(107,114,128,0.3); }

.status-ok {
    background: rgba(16,185,129,0.2);
    color: var(--success);
    border-radius: 8px;
    padding: 8px 16px;
    font-size: 13px;
    font-weight: 600;
}

.status-problem {
    background: rgba(239,68,68,0.2);
    color: var(--danger);
    border-radius: 8px;
    padding: 8px 16px;
    font-size: 13px;
    font-weight: 600;
}

/* Time range bar / filters */

.time-range-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(255,255,255,0.05);
    padding: 16px 20px;
    border-radius: 12px;
    margin-bottom: 24px;
    flex-wrap: wrap;
    gap: 16px;
}

.time-range-selector {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.time-btn {
    background: rgba(255,255,255,0.08);
    color: var(--text-secondary);
    border: 1px solid rgba(255,255,255,0.1);
    padding: 8px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    transition: all 0.3s;
}

.time-btn:hover {
    background: rgba(255,255,255,0.12);
    color: var(--text-primary);
}

.time-btn.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
}

/* Custom date range panel */

.custom-range-panel {
    background: var(--bg-card);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 24px;
    border: 1px solid rgba(255,255,255,0.08);
    display: none;
}

.custom-range-panel.active {
    display: block;
}

.custom-range-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 16px;
    margin-bottom: 16px;
}

.date-input-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.date-input-group label {
    font-size: 13px;
    color: var(--text-secondary);
    font-weight: 600;
    text-transform: uppercase;
}

.date-input-group input {
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.1);
    color: var(--text-primary);
    padding: 10px 14px;
    border-radius: 8px;
    font-size: 14px;
    font-family: inherit;
}

.date-input-group input:focus {
    outline: none;
    border-color: var(--accent);
    background: rgba(255,255,255,0.12);
}

.date-input-group input[type="datetime-local"]::-webkit-calendar-picker-indicator {
    filter: invert(1);
    cursor: pointer;
}

.custom-range-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
}

.apply-btn {
    background: var(--accent);
    color: white;
    border: none;
    padding: 10px 24px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.apply-btn:hover {
    background: #5558e3;
    transform: translateY(-2px);
}

.cancel-btn {
    background: rgba(255,255,255,0.08);
    color: var(--text-primary);
    border: 1px solid rgba(255,255,255,0.1);
    padding: 10px 24px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.cancel-btn:hover {
    background: rgba(255,255,255,0.12);
}

/* Container */

.container-main {
    max-width: 1600px;
    margin: 0 auto;
    padding: 32px 40px;
}

/* Stats row */

.stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-bottom: 32px;
}

.stat-card {
    background: var(--bg-card);
    border-radius: 12px;
    padding: 24px;
    border: 1px solid rgba(255,255,255,0.05);
    transition: all 0.3s;
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    border-color: rgba(99,102,241,0.3);
}

.stat-label {
    font-size: 12px;
    color: var(--text-secondary);
    text-transform: uppercase;
    font-weight: 600;
    letter-spacing: 0.5px;
    margin-bottom: 12px;
}

.stat-value {
    font-size: 36px;
    font-weight: 700;
    line-height: 1;
}

/* Charts grid */

.charts-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 24px;
    margin-bottom: 24px;
}

.chart-section {
    background: var(--bg-card);
    border-radius: 12px;
    padding: 28px;
    border: 1px solid rgba(255,255,255,0.05);
}

.chart-title {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 20px;
    color: var(--text-primary);
}

.full-width-chart {
    grid-column: 1 / -1;
}

/* Periods / downtime list */

.periods-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 24px;
}

.period-section {
    background: var(--bg-card);
    border-radius: 12px;
    padding: 28px;
    border: 1px solid rgba(255,255,255,0.05);
}

.period-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 20px;
    max-height: 500px;
    overflow-y: auto;
}

.period-item {
    background: rgba(255,255,255,0.03);
    border-left: 4px solid;
    padding: 16px 20px;
    border-radius: 8px;
    transition: all 0.3s;
}

.period-item:hover {
    background: rgba(255,255,255,0.06);
    transform: translateX(4px);
}

.period-item.downtime {
    border-left-color: #ef4444;
}

.period-item.maintenance {
    border-left-color: #f59e0b;
}

.period-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.period-number {
    display: inline-block;
    min-width: 28px;
    height: 28px;
    line-height: 28px;
    text-align: center;
    border-radius: 6px;
    font-weight: 700;
    font-size: 13px;
    margin-right: 12px;
}

.period-item.downtime .period-number {
    background: rgba(239,68,68,0.2);
    color: #ef4444;
}

.period-item.maintenance .period-number {
    background: rgba(245,158,11,0.2);
    color: #f59e0b;
}

.period-time {
    font-size: 13px;
    color: var(--text-secondary);
}

.period-duration {
    font-size: 16px;
    font-weight: 700;
}

.no-periods {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-secondary);
}

/* Locations grid (overview page) */

.locations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
    gap: 24px;
}

.location-card {
    background: var(--bg-card);
    border-radius: 16px;
    padding: 32px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    border: 1px solid rgba(255,255,255,0.05);
    transition: all 0.3s;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.location-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--accent), var(--success));
}

.location-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 40px rgba(0,0,0,0.4);
    border-color: rgba(255,255,255,0.15);
}

.location-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
}

.location-name {
    font-size: 24px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 12px;
}

/* Filter card (dashboard style) */

.filter-card {
    background: var(--bg-card);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 32px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    border: 1px solid rgba(255,255,255,0.05);
}

.filter-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.filter-options {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 16px;
}

.filter-btn {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    color: var(--text-primary);
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 14px;
}

.filter-btn:hover {
    background: rgba(255,255,255,0.1);
}

.filter-btn.active {
    background: var(--accent);
    border-color: var(--accent);
}

.custom-date-range {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    align-items: center;
}

.date-input {
    background: var(--bg-secondary);
    border: 1px solid rgba(255,255,255,0.1);
    color: var(--text-primary);
    padding: 10px 14px;
    border-radius: 8px;
    font-size: 14px;
}

.date-input:focus {
    outline: none;
    border-color: var(--accent);
}

/* Modal overlay / dialog */

.modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(4px);
    z-index: 2000;
    animation: fadeIn 0.3s;
    padding: 20px;
}

.modal-overlay.active {
    display: flex !important;
    align-items: center;
    justify-content: center;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to   { opacity: 1; }
}

.modal {
    background: var(--bg-card);
    border-radius: 16px;
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    animation: slideUp 0.3s;
    position: relative;
    z-index: 2001;
}

@keyframes slideUp {
    from { transform: translateY(50px); opacity: 0; }
    to   { transform: translateY(0); opacity: 1; }
}

.modal-header {
    padding: 24px;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--bg-card);
}

.modal-header h2 {
    margin: 0;
    font-size: 24px;
    color: var(--text-primary);
}

.modal-close {
    background: rgba(255,255,255,0.05);
    border: none;
    color: var(--text-primary);
    width: 36px;
    height: 36px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
}

.modal-close:hover {
    background: rgba(255,255,255,0.1);
}

.modal-body {
    padding: 24px;
    background: var(--bg-card);
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    font-size: 14px;
    color: var(--text-primary);
}

.form-input {
    width: 100%;
    background: var(--bg-secondary);
    border: 1px solid rgba(255,255,255,0.1);
    color: var(--text-primary);
    padding: 12px 16px;
    border-radius: 8px;
    font-size: 14px;
    font-family: inherit;
}

.form-input::placeholder {
    color: var(--text-secondary);
}

.form-input:focus {
    outline: none;
    border-color: var(--accent);
    background: var(--bg-primary);
}

.modal-footer {
    padding: 24px;
    border-top: 1px solid rgba(255,255,255,0.05);
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    background: var(--bg-card);
}

/* Add location modal overrides */

#addLocationModal.active {
    display: flex !important;
    background: rgba(0,0,0,0.85) !important;
}

#addLocationModal.active .modal {
    display: block !important;
    background: #1e2541 !important;
    color: white !important;
    border: 3px solid #6366f1 !important;
    min-height: 400px !important;
}

#addLocationModal.active .modal * {
    visibility: visible !important;
    opacity: 1 !important;
}

/* Loading & error */

.loading {
    text-align: center;
    padding: 80px 20px;
}

.spinner {
    width: 64px;
    height: 64px;
    border: 4px solid rgba(255,255,255,0.1);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 24px;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.error-state {
    background: rgba(239,68,68,0.1);
    border: 1px solid var(--danger);
    border-radius: 12px;
    padding: 32px;
    text-align: center;
    color: var(--danger);
}

/* Refresh indicator pill */

.refresh-info {
    display: flex;
    align-items: center;
    gap: 12px;
    color: var(--text-secondary);
    font-size: 14px;
}

.refresh-indicator {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(99,102,241,0.9);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 999;
}

.refresh-indicator.show {
    opacity: 1;
}

.refresh-dot,
.refresh-indicator .pulse {
    width: 8px;
    height: 8px;
    background: var(--success);
    border-radius: 50%;
    animation: pulse-anim 1s infinite;
}

@keyframes pulse-anim {
    0%, 100% { opacity: 1; transform: scale(1); }
    50%      { opacity: 0.3; transform: scale(1.2); }
}

/* Responsive */

@media (max-width: 1200px) {
    .charts-grid {
        grid-template-columns: 1fr;
    }

    .periods-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .sidebar {
        transform: translateX(-100%);
    }

    .sidebar.mobile-open {
        transform: translateX(0);
    }

    .sidebar-toggle {
        display: block;
    }

    .mobile-sidebar-toggle {
        display: flex;
    }

    .main-content {
        margin-left: 0;
        width: 100%;
    }

    .sidebar.collapsed + .main-content {
        margin-left: 0;
        width: 100%;
    }

    .stats-row {
        grid-template-columns: repeat(2, 1fr);
    }

    .header-content,
    .header-top {
        flex-direction: column;
        align-items: flex-start;
    }

    .header-actions {
        width: 100%;
    }

    .action-btn,
    .export-btn {
        flex: 1;
        justify-content: center;
    }

    .custom-range-grid {
        grid-template-columns: 1fr;
    }

    .custom-date-range {
        flex-direction: column;
        align-items: stretch;
    }

    .custom-date-range input,
    .custom-date-range button {
        width: 100%;
    }

    .modal {
        width: 95%;
        max-height: 95vh;
    }
}

    </style>
</head>
<body>
 <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header" onclick="toggleSidebar()">
            <div class="sidebar-logo" >
                <img src="{{ url_for('static', filename='bootstrap-icons/diagram-3.svg') }}" alt="" class="icon-xl icon-accent">
                <span class="logo-text">I-OPS Monitor</span>
            </div>
            
        </div>
        
        <nav class="sidebar-menu">
            <a href="/" class="menu-item active" data-page="dashboard">
                <img src="{{ url_for('static', filename='bootstrap-icons/speedometer2.svg') }}" alt="" class="icon icon-white">
                <span class="menu-text">Dashboard</span>
            </a>
            
            <a href="/schedule" class="menu-item" data-page="schedule">
                <img src="{{ url_for('static', filename='bootstrap-icons/calendar-check.svg') }}" alt="" class="icon icon-white">
                <span class="menu-text">Schedule</span>
            </a>
            
            <a href="/availability" class="menu-item active" data-page="availability">
                <img src="{{ url_for('static', filename='bootstrap-icons/bar-chart-line.svg') }}" alt="" class="icon icon-white">
                <span class="menu-text">Availability</span>
            </a>
            
            <a href="/locations" class="menu-item" data-page="locations">
                <img src="{{ url_for('static', filename='bootstrap-icons/geo-alt.svg') }}" alt="" class="icon icon-white">
                <span class="menu-text">Locations</span>
            </a>
            
            <div style="margin: 20px 0; border-top: 1px solid rgba(255,255,255,0.05);"></div>
        </nav>
    </aside>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <div class="header-top">
                <a href="/availability" class="back-btn">← Back to Availability</a>
                <div class="header-actions">
                    <button class="action-btn primary" id="viewInZabbix">
                        View in Zabbix →
                    </button>
                    <button class="action-btn" onclick="refreshData()">
                        ↻ Refresh
                    </button>
                </div>
            </div>
            
            <div class="header-info">
                <div>
                    <h1 id="hostTitle">Loading...</h1>
                    <div class="header-ip" id="hostIP"></div>
                </div>
                <div id="hostStatus"></div>
            </div>
        </div>
        
        <div class="container-main">
            <!-- Time Range Bar -->
            <div class="time-range-bar">
                <div class="time-range-selector">
                    <button class="time-btn" data-range="24h">24 Hours</button>
                    <button class="time-btn active" data-range="7d">7 Days</button>
                    <button class="time-btn" data-range="30d">30 Days</button>
                    <button class="time-btn" data-range="custom" onclick="toggleCustomRange()">Custom Range</button>
                </div>
                
                <div class="refresh-info">
                    <div class="refresh-indicator">
                        <div class="refresh-dot"></div>
                        <span>Auto-refresh enabled</span>
                    </div>
                    <span id="lastUpdate">Last updated: Just now</span>
                </div>
            </div>
            
            <!-- Custom Range Panel -->
            <div class="custom-range-panel" id="customRangePanel">
                <h3 style="margin-bottom: 16px; font-size: 18px;">Select Custom Date Range</h3>
                <div class="custom-range-grid">
                    <div class="date-input-group">
                        <label>Start Date & Time</label>
                        <input type="datetime-local" id="startDateTime">
                    </div>
                    <div class="date-input-group">
                        <label>End Date & Time</label>
                        <input type="datetime-local" id="endDateTime">
                    </div>
                </div>
                <div class="custom-range-actions">
                    <button class="cancel-btn" onclick="toggleCustomRange()">Cancel</button>
                    <button class="apply-btn" onclick="applyCustomRange()">Apply Range</button>
                </div>
            </div>
            
            <!-- Statistics Row -->
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-label">Availability</div>
                    <div class="stat-value" id="statAvailability">0%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Uptime</div>
                    <div class="stat-value" style="color: #10b981;" id="statUptime">0h</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Unplanned Downtime</div>
                    <div class="stat-value" style="color: #ef4444;" id="statDowntime">0h</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Maintenance Time</div>
                    <div class="stat-value" style="color: #f59e0b;" id="statMaintenance">0h</div>
                </div>
            </div>
            
            <!-- Charts Grid -->
            <div class="charts-grid">
                <!-- Combined Timeline - Full Width -->
                <div class="chart-section full-width-chart">
                    <div class="chart-title">Daily Performance - Availability, Downtime & Maintenance</div>
                    <div style="position: relative; height: 400px;">
                        <canvas id="dailyTimelineChart"></canvas>
                    </div>
                </div>
                
                <!-- Time Distribution -->
                <div class="chart-section">
                    <div class="chart-title">Time Distribution</div>
                    <div style="position: relative; height: 280px;">
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>
                
                <!-- Availability Breakdown -->
                <div class="chart-section">
                    <div class="chart-title">Availability Breakdown</div>
                    <div style="position: relative; height: 280px;">
                        <canvas id="timelineChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Periods Grid -->
            <div class="periods-grid">
                <!-- Downtime Periods -->
                <div class="period-section">
                    <div class="chart-title">Unplanned Downtime <span id="downtimeCount" style="color: var(--text-secondary); font-weight: 400; font-size: 14px;"></span></div>
                    <div class="period-list" id="downtimePeriodsList"></div>
                </div>
                
                <!-- Maintenance Periods -->
                <div class="period-section">
                    <div class="chart-title">Scheduled Maintenance <span id="maintenanceCount" style="color: var(--text-secondary); font-weight: 400; font-size: 14px;"></span></div>
                    <div class="period-list" id="maintenancePeriodsList"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let hostData = JSON.parse(sessionStorage.getItem('selectedHost'));
        let currentTimeRange = sessionStorage.getItem('timeRange') || '7d';
        let currentLocation = sessionStorage.getItem('locationFilter') || 'all';
        let autoRefreshInterval = null;
        let charts = {};
        let customStartTime = null;
        let customEndTime = null;
        
        if (!hostData) {
            window.location.href = '/availability';
        }
        
        // Mobile sidebar toggle
        document.getElementById('sidebarToggle')?.addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('mobile-open');
        });
        
        // Time range selector
        document.querySelectorAll('.time-btn').forEach(btn => {
            if (btn.dataset.range && btn.dataset.range !== 'custom') {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentTimeRange = this.dataset.range;
                    customStartTime = null;
                    customEndTime = null;
                    document.getElementById('customRangePanel').classList.remove('active');
                    refreshData();
                });
            }
            
            if (btn.dataset.range === currentTimeRange) {
                btn.classList.add('active');
            }
        });
        
        // Custom range functions
        function toggleCustomRange() {
            const panel = document.getElementById('customRangePanel');
            panel.classList.toggle('active');
            
            if (panel.classList.contains('active')) {
                const now = new Date();
                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                
                document.getElementById('endDateTime').value = formatDateTimeLocal(now);
                document.getElementById('startDateTime').value = formatDateTimeLocal(weekAgo);
            }
        }
        
        function formatDateTimeLocal(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }
        
        function applyCustomRange() {
            const startDateTime = document.getElementById('startDateTime').value;
            const endDateTime = document.getElementById('endDateTime').value;
            
            if (!startDateTime || !endDateTime) {
                alert('Please select both start and end date/time');
                return;
            }
            
            const start = new Date(startDateTime);
            const end = new Date(endDateTime);
            
            if (start >= end) {
                alert('Start date must be before end date');
                return;
            }
            
            customStartTime = Math.floor(start.getTime() / 1000);
            customEndTime = Math.floor(end.getTime() / 1000);
            currentTimeRange = 'custom';
            
            document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('.time-btn[data-range="custom"]').classList.add('active');
            document.getElementById('customRangePanel').classList.remove('active');
            
            refreshData();
        }
        
        // View in Zabbix button
        document.getElementById('viewInZabbix').addEventListener('click', function() {
            const zabbixUrl = sessionStorage.getItem('zabbixUrl') || 'https://zabbix.example.com';
            const hostId = hostData.hostid || '';
            window.open(`${zabbixUrl}/zabbix.php?action=host.view&hostid=${hostId}`, '_blank');
        });
        
        function formatDurationShort(seconds) {
            if (seconds === 0) return "0h";
            
            const days = Math.floor(seconds / 86400);
            const hours = Math.floor((seconds % 86400) / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            
            const parts = [];
            if (days > 0) parts.push(`${days}d`);
            if (hours > 0 || days > 0) parts.push(`${hours}h`);
            if (minutes > 0 && days === 0) parts.push(`${minutes}m`);
            
            return parts.join(' ') || "0h";
        }
        
        async function refreshData() {
            console.log('Refreshing data...');
            
            try {
                let url = `/api/host-availability?range=${currentTimeRange}&location=${currentLocation}&search=${encodeURIComponent(hostData.hostname)}`;
                
                if (currentTimeRange === 'custom' && customStartTime && customEndTime) {
                    url += `&start=${customStartTime}&end=${customEndTime}`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success && data.hosts.length > 0) {
                    const updatedHost = data.hosts.find(h => h.hostname === hostData.hostname);
                    
                    if (updatedHost) {
                        hostData = updatedHost;
                        sessionStorage.setItem('selectedHost', JSON.stringify(hostData));
                        
                        updateStats();
                        destroyCharts();
                        renderDailyTimelineChart();
                        renderDistributionChart();
                        renderTimelineChart();
                        renderDowntimePeriods();
                        renderMaintenancePeriods();
                        
                        document.getElementById('lastUpdate').textContent = 'Last updated: Just now';
                    }
                }
            } catch (error) {
                console.error('Error refreshing data:', error);
            }
        }
        
        function destroyCharts() {
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });
            charts = {};
        }
        
        function startAutoRefresh() {
            autoRefreshInterval = setInterval(() => {
                refreshData();
                updateLastUpdateTime();
            }, 300000);
        }
        
        function updateLastUpdateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('lastUpdate').textContent = `Last updated: ${timeStr}`;
        }
        
        function updateStats() {
            document.getElementById('statAvailability').textContent = hostData.availability + '%';
            document.getElementById('statUptime').textContent = hostData.uptime_formatted;
            document.getElementById('statDowntime').textContent = hostData.downtime_formatted;
            document.getElementById('statMaintenance').textContent = hostData.maintenance_formatted;
            
            const availEl = document.getElementById('statAvailability');
            const status = hostData.status.toLowerCase();
            if (status === 'excellent') availEl.style.color = '#10b981';
            else if (status === 'good') availEl.style.color = '#84cc16';
            else if (status === 'fair') availEl.style.color = '#f59e0b';
            else if (status === 'poor') availEl.style.color = '#ef4444';
        }
        
        function loadHostDetails() {
            document.getElementById('hostTitle').textContent = hostData.hostname;
            document.getElementById('hostIP').textContent = `IP: ${hostData.ip_address}`;
            
            const statusClass = 'status-' + hostData.status.toLowerCase();
            document.getElementById('hostStatus').innerHTML = `<span class="status-badge ${statusClass}">${hostData.status}</span>`;
            
            updateStats();
            renderDailyTimelineChart();
            renderDistributionChart();
            renderTimelineChart();
            renderDowntimePeriods();
            renderMaintenancePeriods();
            
            startAutoRefresh();
        }
        
        function renderDailyTimelineChart() {
            const ctx = document.getElementById('dailyTimelineChart').getContext('2d');
            
            const dailyData = {};
            const secondsInDay = 86400;
            
            (hostData.downtime_periods || []).forEach(period => {
                const date = period.start.split(' ')[0];
                if (!dailyData[date]) {
                    dailyData[date] = { downtime: 0, maintenance: 0, availability: 100 };
                }
                dailyData[date].downtime += period.duration;
            });
            
            (hostData.maintenance_periods || []).forEach(period => {
                const date = period.start.split(' ')[0];
                if (!dailyData[date]) {
                    dailyData[date] = { downtime: 0, maintenance: 0, availability: 100 };
                }
                dailyData[date].maintenance += period.duration;
            });
            
            Object.keys(dailyData).forEach(date => {
                const downtimeSeconds = dailyData[date].downtime;
                const maintenanceSeconds = dailyData[date].maintenance;
                const uptimeSeconds = secondsInDay - downtimeSeconds - maintenanceSeconds;
                const availabilityPct = (uptimeSeconds / secondsInDay) * 100;
                dailyData[date].availability = Math.max(0, Math.min(100, availabilityPct));
            });
            
            const sortedDates = Object.keys(dailyData).sort();
            const availabilityData = sortedDates.map(date => dailyData[date].availability);
            const downtimeData = sortedDates.map(date => (dailyData[date].downtime / 3600));
            const maintenanceData = sortedDates.map(date => (dailyData[date].maintenance / 3600));
            
            const labels = sortedDates.map(date => {
                const d = new Date(date);
                return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });
            
            charts.daily = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Availability (%)',
                            data: availabilityData,
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: '#10b981',
                            borderWidth: 2,
                            borderRadius: 6,
                            yAxisID: 'y-availability'
                        },
                        {
                            label: 'Downtime (hours)',
                            data: downtimeData,
                            backgroundColor: 'rgba(239, 68, 68, 0.7)',
                            borderColor: '#ef4444',
                            borderWidth: 2,
                            borderRadius: 6,
                            yAxisID: 'y-time'
                        },
                        {
                            label: 'Maintenance (hours)',
                            data: maintenanceData,
                            backgroundColor: 'rgba(245, 158, 11, 0.7)',
                            borderColor: '#f59e0b',
                            borderWidth: 2,
                            borderRadius: 6,
                            yAxisID: 'y-time'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: '#a0aec0',
                                font: { weight: '600', size: 12 },
                                maxRotation: 45,
                                minRotation: 0
                            }
                        },
                        'y-availability': {
                            type: 'linear',
                            position: 'left',
                            min: 0,
                            max: 100,
                            grid: {
                                color: 'rgba(16, 185, 129, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#10b981',
                                font: { weight: '600', size: 12 },
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Availability (%)',
                                color: '#10b981',
                                font: { weight: '700', size: 14 }
                            }
                        },
                        'y-time': {
                            type: 'linear',
                            position: 'right',
                            min: 0,
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: '#ef4444',
                                font: { weight: '600', size: 12 },
                                callback: function(value) {
                                    return value.toFixed(1) + 'h';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Downtime / Maintenance (hours)',
                                color: '#ef4444',
                                font: { weight: '700', size: 14 }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#ffffff',
                                padding: 20,
                                font: { weight: '600', size: 14 },
                                usePointStyle: true,
                                pointStyle: 'rect'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(30, 37, 65, 0.95)',
                            titleColor: '#ffffff',
                            bodyColor: '#a0aec0',
                            borderColor: 'rgba(99,102,241,0.5)',
                            borderWidth: 2,
                            padding: 16,
                            displayColors: true,
                            callbacks: {
                                title: function(context) {
                                    return 'Date: ' + sortedDates[context[0].dataIndex];
                                },
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.parsed.y;
                                    
                                    if (label.includes('Availability')) {
                                        return `${label}: ${value.toFixed(2)}%`;
                                    } else if (label.includes('Downtime') || label.includes('Maintenance')) {
                                        const hours = Math.floor(value);
                                        const minutes = Math.round((value - hours) * 60);
                                        return `${label}: ${hours}h ${minutes}m`;
                                    }
                                    return `${label}: ${value}`;
                                },
                                afterBody: function(context) {
                                    const index = context[0].dataIndex;
                                    const date = sortedDates[index];
                                    const data = dailyData[date];
                                    
                                    return [
                                        '',
                                        `Total downtime: ${formatDurationShort(data.downtime)}`,
                                        `Total maintenance: ${formatDurationShort(data.maintenance)}`
                                    ];
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function renderDistributionChart() {
            const ctx = document.getElementById('distributionChart').getContext('2d');
            
            charts.distribution = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Uptime', 'Downtime', 'Maintenance'],
                    datasets: [{
                        data: [hostData.uptime_seconds, hostData.downtime_seconds, hostData.maintenance_seconds || 0],
                        backgroundColor: ['rgba(16, 185, 129, 0.8)', 'rgba(239, 68, 68, 0.8)', 'rgba(245, 158, 11, 0.8)'],
                        borderColor: ['#10b981', '#ef4444', '#f59e0b'],
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#ffffff', padding: 15, font: { size: 13, weight: '600' } }
                        }
                    }
                }
            });
        }
        
        function renderTimelineChart() {
            const ctx = document.getElementById('timelineChart').getContext('2d');
            
            charts.timeline = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Time Distribution'],
                    datasets: [
                        {
                            label: 'Uptime',
                            data: [hostData.uptime_seconds],
                            backgroundColor: 'rgba(16, 185, 129, 0.8)',
                            borderColor: '#10b981',
                            borderWidth: 2
                        },
                        {
                            label: 'Downtime',
                            data: [hostData.downtime_seconds],
                            backgroundColor: 'rgba(239, 68, 68, 0.8)',
                            borderColor: '#ef4444',
                            borderWidth: 2
                        },
                        {
                            label: 'Maintenance',
                            data: [hostData.maintenance_seconds || 0],
                            backgroundColor: 'rgba(245, 158, 11, 0.8)',
                            borderColor: '#f59e0b',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: {
                                color: '#a0aec0',
                                callback: value => formatDurationShort(value)
                            }
                        },
                        y: {
                            stacked: true,
                            grid: { display: false },
                            ticks: { color: '#a0aec0' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#ffffff', font: { weight: '600', size: 12 } }
                        }
                    }
                }
            });
        }
        
        function renderDowntimePeriods() {
            const container = document.getElementById('downtimePeriodsList');
            const periods = hostData.downtime_periods || [];
            
            document.getElementById('downtimeCount').textContent = `(${periods.length})`;
            
            if (periods.length === 0) {
                container.innerHTML = '<div class="no-periods">No unplanned downtime</div>';
                return;
            }
            
            container.innerHTML = periods.map((period, index) => `
                <div class="period-item downtime">
                    <div class="period-header">
                        <div>
                            <span class="period-number">${index + 1}</span>
                            <span class="period-time">${period.start}</span>
                        </div>
                        <div class="period-duration" style="color: #ef4444;">
                            ${formatDurationShort(period.duration)}
                        </div>
                    </div>
                    <div class="period-time" style="margin-left: 40px;">
                        ${period.end}
                    </div>
                </div>
            `).join('');
        }
        
        function renderMaintenancePeriods() {
            const container = document.getElementById('maintenancePeriodsList');
            const periods = hostData.maintenance_periods || [];
            
            document.getElementById('maintenanceCount').textContent = `(${periods.length})`;
            
            if (periods.length === 0) {
                container.innerHTML = '<div class="no-periods">No maintenance periods</div>';
                return;
            }
            
            container.innerHTML = periods.map((period, index) => `
                <div class="period-item maintenance">
                    <div class="period-header">
                        <div>
                            <span class="period-number">${index + 1}</span>
                            <span class="period-time">${period.start}</span>
                        </div>
                        <div class="period-duration" style="color: #f59e0b;">
                            ${formatDurationShort(period.duration)}
                        </div>
                    </div>
                    <div class="period-time" style="margin-left: 40px;">
                        ${period.end}
                    </div>
                </div>
            `).join('');
        }
        
        window.addEventListener('beforeunload', () => {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        });
        
        loadHostDetails();
function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        }
        
        function toggleMobileSidebar() {
            document.getElementById('sidebar').classList.toggle('mobile-open');
        }
    </script>
</body>
</html>
